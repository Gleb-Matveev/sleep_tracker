<section class="card">
  <div class="card-header">
    <h1 class="card-title">Edit goal</h1>
    <span class="badge-pill">Your priorities</span>
  </div>

  <p class="card-subtitle">
    Update your sleep goal.
  </p>

  <form action="/goal/{{goal.id}}" method="post" style="margin-top: 1rem; display: grid; gap: 0.9rem;" id="edit-form">
    <div>
      <label for="name" class="card-subtitle" style="display: block; margin-bottom: 0.35rem;">Title</label>
      <input id="name" name="name" type="text" placeholder="e.g. Sleep 8 hours on weekdays" value="{{goal.name}}" required>
    </div>

    <div>
      <label for="description" class="card-subtitle" style="display: block; margin-bottom: 0.35rem;">Description</label>
      <textarea id="description" name="description" rows="3" placeholder="What exactly should be achieved?" required>{{goal.description}}</textarea>
    </div>

    <div>
      <label for="status" class="card-subtitle" style="display: block; margin-bottom: 0.35rem;">Status</label>
      <select id="status" name="status">
        <option value="Not done" {{#eq goal.status "Not done"}}selected{{/eq}}>Not done</option>
        <option value="Done" {{#eq goal.status "Done"}}selected{{/eq}}>Done</option>
      </select>
    </div>

    <div style="display: flex; gap: 0.6rem; justify-content: flex-end;">
      <a class="btn btn-secondary" href="/goal">Cancel</a>
      <button class="btn" type="submit">Update goal</button>
    </div>
  </form>
</section>

<script>
  document.getElementById('edit-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);
    
    await fetch(form.action, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });
    
    window.location.href = '/goal';
  });
</script>

