<section class="card">
  <div class="card-header">
    <h1 class="card-title">Add sleep day</h1>
    <span class="badge-pill">Last nights</span>
  </div>

  <p class="card-subtitle">
    Log your sleep stats for the selected date.
  </p>

  <form action="/day" method="post" style="margin-top: 1rem; display: grid; gap: 0.9rem;">
    <div style="display: grid; gap: 0.8rem; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
      <div>
        <label for="date" class="card-subtitle" style="display: block; margin-bottom: 0.35rem;">Date</label>
        <input id="date" name="date" type="date" required>
      </div>
      <div>
        <label for="wakeUpTime" class="card-subtitle" style="display: block; margin-bottom: 0.35rem;">Wake up time</label>
        <input id="wakeUpTime" name="wakeUpTime" type="time" required>
      </div>
      <div>
        <label for="wakeDownTime" class="card-subtitle" style="display: block; margin-bottom: 0.35rem;">Bed time</label>
        <input id="wakeDownTime" name="wakeDownTime" type="time" required>
      </div>
    </div>

    <div style="display: grid; gap: 0.8rem; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
      <div>
        <label for="getup_score" class="card-subtitle" style="display: block; margin-bottom: 0.35rem;">GetUp score (0-10)</label>
        <input id="getup_score" name="getup_score" type="number" min="0" max="10" step="0.1" required>
      </div>
      <div>
        <label for="feeling_score" class="card-subtitle" style="display: block; margin-bottom: 0.35rem;">Feeling score (0-10)</label>
        <input id="feeling_score" name="feeling_score" type="number" min="0" max="10" step="0.1" required>
      </div>
    </div>

    <div>
      <label for="description" class="card-subtitle" style="display: block; margin-bottom: 0.35rem;">Notes</label>
      <textarea id="description" name="description" rows="3" placeholder="How you slept, what helped or disturbed?"></textarea>
    </div>

    <div>
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.35rem;">
        <label class="card-subtitle">Steps</label>
        <button type="button" class="btn btn-secondary" id="add-routine-btn">+ Add step</button>
      </div>
      <div id="routines-list" style="display: grid; gap: 0.5rem;">
        <div class="step-row" style="display: grid; grid-template-columns: 1fr auto; gap: 0.5rem;">
          <input name="routineIds[]" type="text" placeholder="Open curtains and get daylight" required>
          <button type="button" class="btn btn-secondary remove-step-btn" aria-label="Remove step">&minus;</button>
        </div>
      </div>
    </div>

    <div style="display: flex; gap: 0.6rem; justify-content: flex-end;">
      <a class="btn btn-secondary" href="/day">Cancel</a>
      <button class="btn" type="submit">Save day</button>
    </div>
  </form>
</section>

<script>
  (() => {
    const routinesList = document.getElementById('routines-list');
    const addBtn = document.getElementById('add-routine-btn');

    const createRow = (value = '') => {
      const row = document.createElement('div');
      row.className = 'step-row';
      row.style.display = 'grid';
      row.style.gridTemplateColumns = '1fr auto';
      row.style.gap = '0.5rem';

      const input = document.createElement('input');
      input.name = 'routineIds[]';
      input.type = 'text';
      input.placeholder = 'Routine';
      input.required = true;
      input.value = value;

      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.className = 'btn btn-secondary remove-step-btn';
      removeBtn.setAttribute('aria-label', 'Remove routines');
      removeBtn.textContent = 'âˆ’';
      removeBtn.addEventListener('click', () => {
        if (routinesList.children.length > 1) {
          row.remove();
        } else {
          input.value = '';
          input.focus();
        }
      });

      row.appendChild(input);
      row.appendChild(removeBtn);
      return row;
    };

    addBtn?.addEventListener('click', () => {
      routinesList.appendChild(createRow());
    });
  })();
</script>